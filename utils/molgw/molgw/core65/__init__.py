#!/usr/bin/python3
##################################################
#
# This file is part of MOLGW
# Author: Fabien Bruneval
#
# This python submodule provides useful functions to prepare/analyze core65 runs
#
#
##################################################

import numpy as np
import json, yaml
import pathlib
import matplotlib.pyplot as plt
from molgw import __version__, Molecule

chemical_formulas = { 
          "10028-15-6": "O3",
          "107-31-3":   "HCO2CH3",
          "109-97-7":   "C4H4NH",
          "110-86-1":   "C5H5N",
          "115-10-6":   "CH3OCH3",
          "124-38-9":   "CO2",
          "50-00-0":    "CH2O",
          "536-74-3":   "C8H6",
          "56-40-6":    "C2H5NO2",
          "57-13-6":    "CO(NH2)2",
          "593-53-3":   "CH3F",
          "62-53-3":    "C6H5NH2",
          "630-08-0":   "CO",
          "64-18-6":    "HCOOH",
          "64-19-7":    "CH3COOH",
          "67-56-1":    "CH3OH",
          "67-64-1":    "(CH3)2CO",
          "71-43-2":    "C6H6",
          "74-82-8":    "CH4",
          "74-84-0":    "C2H6",
          "74-85-1":    "C2H4",
          "74-86-2":    "C2H2",
          "74-89-5":    "CH3NH2",
          "74-90-8":    "HCN",
          "75-05-8":    "CH3CN",
          "75-46-7":    "HCF3",
          "75-73-0":    "CF4",
          "7664-41-7":  "NH3",
          "7727-37-9":  "N2",
          "7732-18-5":  "H2O",
          "7782-44-7":  "O2",
          "98-95-3":    "C6H5NO2"
}

names = { 
          "10028-15-6": "ozone",
          "107-31-3":   "methylformate",
          "109-97-7":   "pyrrole",
          "110-86-1":   "pyridine",
          "115-10-6":   "dimethyl ether",
          "124-38-9":   "carbon dioxide",
          "50-00-0":    "formaldehyde",
          "536-74-3":   "phenylacetylene",
          "56-40-6":    "glycine",
          "57-13-6":    "urea",
          "593-53-3":   "fluoromethane",
          "62-53-3":    "aniline",
          "630-08-0":   "carbon monoxide",
          "64-18-6":    "formic acid",
          "64-19-7":    "acetic acid",
          "67-56-1":    "methanol",
          "67-64-1":    "acetone",
          "71-43-2":    "benzene",
          "74-82-8":    "methane",
          "74-84-0":    "ethane",
          "74-85-1":    "ethene",
          "74-86-2":    "ethyne",
          "74-89-5":    "methylamine",
          "74-90-8":    "hydrogen cyanide",
          "75-05-8":    "acetonitrile",
          "75-46-7":    "trifluoromethane",
          "75-73-0":    "tetrafluoromethane",
          "7664-41-7":  "ammonia",
          "7727-37-9":  "nitrogen",
          "7732-18-5":  "water",
          "7782-44-7":  "oxygen",
          "98-95-3":    "nitrobenzene"
        }

cas = list(chemical_formulas.keys())

get_cas = {}
for k, v in chemical_formulas.items():
    if not "_old" in k:
        get_cas[v] = k

default_input_parameters = { 
      'scf': 'pbeh',
      'alpha_hybrid': 0.45,
      'postscf': 'g0w0',
      'basis': 'pcSseg-3',
      'auxil_basis': 'pauto',
      'selfenergy_state_max': 5,
      'ncoreg': 0,
      'ncorew': 0
              }

core65_path = str(pathlib.Path(__file__).resolve().parent)
with open(core65_path + '/core65_reference.yaml', 'r') as stream:
    reference_data = yaml.load(stream, Loader=yaml.Loader)

relativistic_correction = {
                            'C1s': -0.118,
                            'O1s': -0.424,
                            'F1s': -0.708,
                            'N1s': -0.236
                          }
# Number of frozen MO: none
frozencore = {
    'H':  0,
    'C': 0,
    'N': 0,
    'O': 0,
    'F': 0,
}

def get_frozencore(cas):
    structure_string = structures[cas]
    lines = structure_string.split('\n')
    natom = int(lines[0])
    frozen_orbitals = 0
    for iatom in range(natom):
        element = lines[iatom+2].split()[0]
        frozen_orbitals += frozencore[element]
    return frozen_orbitals

structures = {
'536-74-3': '14\n536-74-3 phenylacetylene\nC  -0.00612772  -0.00000000  -0.00366540  \nC  0.00615911  -0.00000000  1.40498019  \nC  1.21436228  0.00000000  2.09653622  \nC  2.42549796  -0.00000000  1.40038676  \nC  2.42294935  0.00000000  0.00342385  \nC  1.21999705  0.00000000  -0.69724347  \nH  -0.94095544  -0.00000000  1.94258656  \nH  1.21101605  0.00000000  3.18643836  \nH  3.36922553  0.00000000  1.94531685  \nH  3.36522067  -0.00000000  -0.54431803  \nH  1.21214953  -0.00000000  -1.78627509  \nC  -1.23887482  0.00000000  -0.71531790  \nC  -2.28958565  0.00000000  -1.32166431  \nH  -3.21551592  0.00000000  -1.85618457  \n', '10028-15-6': '3\n10028-15-6 ozone\nO  -0.00000000  -0.00000000  0.00456380  \nO  1.09211783  0.00000000  0.65771810  \nO  -1.09211783  0.00000000  0.65771810  \n', '107-31-3': '8\n107-31-3 methyl formate\nC  0.86457643  0.00000329  -2.09755153  \nH  1.24220672  -0.00000158  -1.05754836  \nO  -0.30018526  -0.00000145  -2.41802038  \nO  1.92113699  0.00000018  -2.93626497  \nC  1.58873673  -0.00000011  -4.34452703  \nH  2.54743161  -0.00000013  -4.86908670  \nH  1.00656987  -0.89344742  -4.60069386  \nH  1.00656991  0.89344721  -4.60069416  \n', '109-97-7': '10\n109-97-7 pyrrole\nN  -0.05326883  -0.00000000  -0.03489100  \nC  -0.00684264  -0.00000000  1.33914500  \nC  1.32414709  0.00000000  1.71091384  \nC  2.10064781  0.00000000  0.51804666  \nC  1.22196072  -0.00000000  -0.54855999  \nH  1.39693037  -0.00000000  -1.61775644  \nH  3.18250643  0.00000000  0.44556750  \nH  1.69581388  0.00000000  2.72950809  \nH  -0.91370286  -0.00000000  1.93192868  \nH  -0.90016997  0.00000000  -0.58618835  \n', '110-86-1': '11\n110-86-1 pyridine\nN  -0.00322059  0.00426578  -0.00000000  \nC  -0.47499680  -1.25070938  -0.00000000  \nC  -0.90695994  0.99459800  0.00000000  \nC  -2.28756724  0.78502056  -0.00000000  \nC  -1.83481801  -1.56829305  -0.00000000  \nC  -2.76116301  -0.52628749  -0.00000000  \nH  -0.50303291  2.01022116  0.00000000  \nH  0.27695393  -2.04393084  -0.00000000  \nH  -2.97174757  1.63324322  -0.00000000  \nH  -2.15550869  -2.60979343  0.00000000  \nH  -3.83167616  -0.73225154  -0.00000000  \n', '115-10-6': '9\n115-10-6 dimethyl ether\nO  0.01623528  0.00000000  0.01147927  \nC  -0.01482991  0.00000000  1.42695718  \nC  1.34041603  0.00000000  -0.48961029  \nH  1.27376932  -0.00000000  -1.58363588  \nH  1.89998375  0.89668449  -0.16294794  \nH  1.89998375  -0.89668449  -0.16294794  \nH  -1.06849360  -0.00000000  1.72881110  \nH  0.47969769  -0.89667779  1.84562525  \nH  0.47969769  0.89667779  1.84562525  \n', '124-38-9': '3\n124-38-9 carbon dioxide\nO  -0.00000000  -0.00000000  1.17047111  \nC  0.00000000  0.00000000  -0.00000000  \nO  -0.00000000  -0.00000000  -1.17047111  \n', '50-00-0': '4\n50-00-0 formaldehyde\nC  -0.00000000  0.00000000  0.00282713  \nO  0.00000000  -0.00000000  1.21028792  \nH  0.94699789  -0.00000000  -0.58985753  \nH  -0.94699789  -0.00000000  -0.58985753  \n', '56-40-6': '10\n56-40-6 glycine\nC  -0.04879702  -0.00000000  1.40419128  \nN  -1.35021542  0.00000000  2.04225544  \nC  -0.04354337  0.00000000  -0.12235209  \nO  -1.02422569  -0.00000000  -0.83489570  \nO  1.22983691  0.00000000  -0.61028238  \nH  1.14837668  -0.00000000  -1.58391528  \nH  0.53209836  -0.87421885  1.73662058  \nH  0.53209836  0.87421885  1.73662058  \nH  -1.88873390  0.81280508  1.74087629  \nH  -1.88873390  -0.81280508  1.74087629  \n', '57-13-6': '8\n57-13-6 urea\nO  -0.00000000  1.31763674  -0.00000000  \nC  -0.00000000  0.09352609  0.00000000  \nN  1.16613856  -0.66187329  -0.02938262  \nN  -1.16613856  -0.66187329  0.02938262  \nH  1.15571284  -1.58245187  0.39601109  \nH  1.99797941  -0.11680626  0.16563531  \nH  -1.15571284  -1.58245187  -0.39601109  \nH  -1.99797941  -0.11680626  -0.16563531  \n', '593-53-3': '5\n593-53-3 fluoromethane\nC  0.00863382  -0.01495920  0.00611052  \nH  0.00260325  -0.00450550  1.10443341  \nH  1.04213378  -0.00450788  -0.36568798  \nH  -0.51716250  -0.90476795  -0.36569384  \nF  -0.64981636  1.12551553  -0.45949111  \n', '62-53-3': '14\n62-53-3 aniline\nC  -1.08322941  -0.87306491  -0.00074795  \nC  0.21367008  -1.39163706  -0.00834146  \nC  1.29392410  -0.50621844  0.00054486  \nC  1.08709523  0.87104356  0.01658063  \nC  -0.21675248  1.39742849  0.02495021  \nC  -1.30121917  0.50247424  0.01530767  \nH  -1.94027968  -1.54716310  -0.00608840  \nH  0.37975193  -2.46781904  -0.01996309  \nH  2.31431563  -0.89062294  -0.00377800  \nH  1.94119345  1.55084179  0.01872641  \nH  -2.32050111  0.89319779  0.01649565  \nN  -0.42945956  2.77562484  -0.02088746  \nH  0.33336724  3.34753153  0.32460040  \nH  -1.32977524  3.09087124  0.32314952  \n', '630-08-0': '2\n630-08-0 carbon monoxide\nC  -0.00000000  0.00000000  0.07378202  \nO  0.00000000  0.00000000  1.20921798  \n', '64-18-6': '5\n64-18-6 formic acid\nO  0.99539166  0.00000000  2.04433409  \nH  -1.03491626  0.00000000  1.72629519  \nC  0.00641687  -0.00000001  1.35393061  \nO  -0.00398886  -0.00000000  0.00010557  \nH  0.93169660  0.00000000  -0.28766545  \n', '64-19-7': '8\n64-19-7 acetic acid\nC  0.06987080  0.00000000  -0.01556910  \nO  -0.04805568  -0.00000000  1.34521767  \nO  1.14508363  -0.00000000  -0.57599308  \nH  0.86698827  -0.00000000  1.68904768  \nC  -1.27200333  0.00000000  -0.69930125  \nH  -2.10176112  0.00000000  0.01270158  \nH  -1.33697579  0.88302143  -1.34696775  \nH  -1.33697579  -0.88302143  -1.34696775  \n', '67-56-1': '6\n67-56-1 methanol\nC  -0.72621163  -0.01396083  0.00081861  \nO  0.70098012  0.00264395  -0.00142482  \nH  -1.02758845  -1.06791437  0.00399808  \nH  -1.15279322  0.46446619  -0.89700965  \nH  -1.14999624  0.46912430  0.89744859  \nH  0.99167641  0.92622076  -0.00390182  \n', '67-64-1': '10\n67-64-1 acetone\nC  1.29014502  -0.00000000  -0.72072889  \nC  0.00000000  0.00000000  0.07701340  \nC  -1.29014502  -0.00000000  -0.72072889  \nO  0.00000000  0.00000000  1.29570905  \nH  -2.15098489  -0.00000000  -0.04550817  \nH  -1.33345511  0.88156093  -1.37731159  \nH  -1.33345511  -0.88156093  -1.37731159  \nH  1.33345511  0.88156093  -1.37731159  \nH  2.15098489  -0.00000000  -0.04550817  \nH  1.33345511  -0.88156093  -1.37731159  \n', '71-43-2': '12\n71-43-2 benzene\nC  0.00000000  1.39662763  -0.00000000  \nC  1.20953714  0.69832571  -0.00000000  \nC  1.20953714  -0.69832571  0.00000000  \nC  -0.00000000  -1.39662763  0.00000000  \nC  -1.20953714  -0.69832571  0.00000000  \nC  -1.20953714  0.69832571  -0.00000000  \nH  -0.00000000  2.48682748  0.00000000  \nH  2.15367293  1.24342882  0.00000000  \nH  2.15367293  -1.24342882  -0.00000000  \nH  -0.00000000  -2.48682748  -0.00000000  \nH  -2.15367293  -1.24342882  -0.00000000  \nH  -2.15367293  1.24342882  0.00000000  \n', '74-82-8': '5\n74-82-8 methane\nC  0.00000016  0.00001918  0.00000016  \nH  0.63232625  -0.63226771  0.63232625  \nH  -0.63232571  0.63233315  0.63230028  \nH  -0.63230098  -0.63231778  -0.63230098  \nH  0.63230028  0.63233315  -0.63232571  \n', '74-84-0': '8\n74-84-0 ethane\nC  0.00007608  0.76237909  -0.00002308  \nC  -0.00007712  -0.76597917  0.00001550  \nH  -0.13501924  1.16512977  -1.01323040  \nH  -0.80977542  1.16521309  0.62361131  \nH  0.94514306  1.16503677  0.38955295  \nH  0.80986467  -1.16881307  -0.62350165  \nH  0.13487173  -1.16872963  1.01324245  \nH  -0.94508776  -1.16863683  -0.38969709  \n', '74-85-1': '6\n74-85-1 ethene\nC  0.00000000  -0.00000000  -0.00156818  \nC  0.00000000  -0.00000000  1.33056818  \nH  0.92757992  0.00000000  -0.57540585  \nH  -0.92757992  0.00000000  -0.57540585  \nH  0.92757992  0.00000000  1.90440585  \nH  -0.92757992  0.00000000  1.90440585  \n', '74-86-2': '4\n74-86-2 ethyne\nC  -0.00000000  0.00000000  0.60316922  \nC  0.00000000  0.00000000  -0.60316922  \nH  0.00000000  -0.00000000  1.67312311  \nH  0.00000000  -0.00000000  -1.67312311  \n', '74-89-5': '7\n74-89-5 methylamine\nC  0.06541359  -0.02176081  0.00914890  \nN  0.21282286  -0.01281513  1.46838701  \nH  1.18933014  0.12764058  1.72720525  \nH  -0.05884843  -0.91467209  1.85969298  \nH  -0.99265173  -0.16847423  -0.24588345  \nH  0.35776661  0.95902789  -0.38917816  \nH  0.65169696  -0.79197520  -0.52637653  \n', '74-90-8': '3\n74-90-8 hydrogen cyanide\nC  0.00000000  0.00000000  -0.00165375  \nH  -0.00000000  -0.00000000  1.07300224  \nN  -0.00000000  -0.00000000  -1.15904849  \n', '75-05-8': '6\n75-05-8 acetonitrile\nC  0.00756787  -0.00000000  0.01027593  \nN  -0.00744883  -0.00000000  1.17162554  \nC  0.02635660  0.00000000  -1.44287105  \nH  -0.99804211  -0.00000000  -1.83627095  \nH  0.54589874  0.89147628  -1.81635574  \nH  0.54589874  -0.89147628  -1.81635574  \n', '75-46-7': '5\n75-46-7 trifluoromethane\nC  -0.00690361  -0.01195201  -0.00487939  \nF  0.00417086  0.00722166  1.34565038  \nF  1.27008215  0.00722026  -0.44461398  \nF  -0.62878659  1.10353466  -0.44461915  \nH  -0.52495080  -0.90924857  -0.37120286  \n', '75-73-0': '5\n75-73-0 tetrafluoromethane\nC  -0.00000000  -0.00000000  0.00000000  \nF  0.77199015  -0.77199015  0.77199015  \nF  -0.77199015  0.77199015  0.77199015  \nF  -0.77199015  -0.77199015  -0.77199015  \nF  0.77199015  0.77199015  -0.77199015  \n', '7664-41-7': '4\n7664-41-7 ammonia\nN  -0.00000000  0.00003004  0.00668480  \nH  0.00000000  -0.94342500  -0.38383647  \nH  0.81706006  0.47174748  -0.38382417  \nH  -0.81706006  0.47174748  -0.38382417  \n', '7727-37-9': '2\n7727-37-9 nitrogen\nN  0.00000000  0.00000000  -0.00240360  \nN  -0.00000000  -0.00000000  1.10010360  \n', '7732-18-5': '3\n7732-18-5 water\nO  0.00000000  -0.00000000  -0.00614048  \nH  0.76443318  -0.00000000  0.58917024  \nH  -0.76443318  0.00000000  0.58917024  \n', '7782-44-7': '2\n7782-44-7 oxygen\nO  0.00000000  0.00000000  -0.00423076  \nO  0.00000000  -0.00000000  1.21423076  \n', '98-95-3': '14\n98-95-3 nitrobenzene\nC  0.03302949  -0.00000000  0.01902629  \nC  0.00551295  -0.00000000  1.41210676  \nC  1.21608189  0.00000000  2.10174593  \nC  2.42435435  -0.00000000  1.39971800  \nC  2.42824052  0.00000000  0.00229416  \nC  1.22573685  -0.00000000  -0.70131823  \nH  -0.95226452  0.00000000  1.92695455  \nH  1.21573466  0.00000000  3.19104274  \nH  3.36808689  -0.00000000  1.94460724  \nH  3.37144656  0.00000000  -0.54261092  \nH  1.19273753  0.00000000  -1.78820087  \nN  -1.25125394  0.00000000  -0.72241779  \nO  -2.29130114  -0.00000000  -0.06114202  \nO  -1.19866009  -0.00000000  -1.95376383  \n'
}

#
# core65.molecule: dictionary of molgw.Molecule objects
# 
molecule = dict()
for k, v in structures.items():
    molecule[k] = Molecule(v)


#ccsdt_homo = {
#    "orbital": "HOMO", 
#    "remark": "", 
#    "code": "CFOUR and Gaussian16", 
#    "basis_size": "3", 
#    "basis": "gaussian", 
#    "code_version": "", 
#    "qpe": "",
#    "DOI": "https://doi.org/10.3389/fchem.2021.749779",
#    "basis_name": "def2-TZVPP", 
#    "calc_type": "CCSD(T)", 
#    "data": {
#        "106-97-8": -11.567, 
#        "558-13-4": -10.41199, 
#        "7722-84-1": -11.51763, 
#        "65-71-4": -9.081, 
#        "7782-41-4": -15.58481, 
#        "108-88-3": -8.96840, 
#        "100-41-4": -8.91875, 
#        "23878-46-8": -9.84959, 
#        "74-84-0": -12.71117, 
#        "71-43-2": -9.36006, 
#        "593-66-8": -9.327, 
#        "7783-60-0": -12.58832, 
#        "12184-80-4": -11.24071, 
#        "13768-60-0": -11.08635, 
#        "7758-02-3": -8.127, 
#        "71-30-7": -8.77093,
#        "7439-90-9": -13.94, 
#        "19287-45-7": -12.25030, 
#        "7732-18-5": -12.565, 
#        "64-18-6": -11.421, 
#        "74-98-6": -12.03385, 
#        "7440-63-3": -12.260, 
#        "7803-51-2": -10.523, 
#        "62-53-3": -8.04342, 
#        "630-08-0": -14.209, 
#        "7580-67-8": -7.961, 
#        "39297-88-6": -4.39181, 
#        "7784-23-8": -9.71683, 
#        "7783-40-6": -13.710,
#        "7446-09-5": -12.29831, 
#        "1590-87-0": -10.645, 
#        "12190-70-4": -7.566, 
#        "10028-15-6": -12.70550, 
#        "7727-37-9": -15.4767, 
#        "7664-41-7": -10.807, 
#        "75-07-0": -10.207, 
#        "1333-74-0": -16.403, 
#        "7783-06-4": -10.31, 
#        "7647-14-5": -9.02732, 
#        "12185-09-0": -10.52987, 
#        "74-85-1": -10.666, 
#        "74-82-8": -14.373, 
#        "73-24-5": -8.33, 
#        "542-92-7": -8.71208, 
#        "302-01-2": -9.68764, 
#        "75-19-4": -10.865, 
#        "593-60-2_old": -9.269, 
#        "593-60-2": -9.84109,
#        "17108-85-9": -9.771, 
#        "25681-81-6": -3.94089, 
#        "7693-26-7": -6.128, 
#        "7803-62-5": -12.796, 
#        "12187-06-3": -7.494, 
#        "73-40-5": -8.034, 
#        "7440-01-9": -21.32107, 
#        "74-90-8": -13.72282,
#        "10043-11-5": -11.98447,
#        "57-13-6": -10.053, 
#        "7789-24-4": -11.32066,
#        "7440-59-7": -24.512, 
#        "507-25-5": -9.19399, 
#        "74-86-2": -11.424, 
#        "60-29-7": -9.816, 
#        "7664-39-3": -16.026, 
#        "629-20-9": -8.39799, 
#        "110-86-1": -9.72955, 
#        "56-23-5": -11.49885, 
#        "14868-53-2": -9.27474, 
#        "66-22-8": -9.48267,
#        "67-56-1": -11.042, 
#        "13283-31-3": -13.27449, 
#        "75-73-0": -16.22752, 
#        "75-01-4": -10.093, 
#        "108-95-2_old": -8.702, 
#        "108-95-2": -8.64963,
#        "7784-18-1": -15.32499,
#        "75-15-0": -9.981, 
#        "7553-56-2": -9.48436, 
#        "14452-59-6": -5.266, 
#        "124-38-9": -13.7112, 
#        "17739-47-8": -11.81239, 
#        "7440-37-1": -15.544, 
#        "7782-79-8": -10.676, 
#        "392-56-3": -9.93, 
#        "75-02-5": -10.554, 
#        "1304-56-9": -9.94321, 
#        "463-58-1": -11.173, 
#        "50-00-0": -10.84, 
#        "64-17-5": -10.685, 
#        "7726-95-6": -10.52389, 
#        "7782-65-2": -12.497, 
#        "7786-30-3": -11.65515, 
#        "1603-84-5": -10.47061, 
#        "7783-63-3": -15.41022, 
#        "544-92-3": -10.854,
#        "39297-86-4": -4.24246, 
#        "7647-01-0": -12.593, 
#        "7784-42-1": -10.398, 
#        "1309-48-4": -7.90916,
#        "25681-80-5": -4.07463, 
#        "25681-79-2": -4.95498, 
#        "7782-50-5": -11.40512
#    }
#}
#
#g0w0_hf_homo = {
#  "code": "MOLGW",
#  "code_version": "3.3",
#  "basis": "gaussian",
#  "qpe": "solved",
#  "DOI": "unpublished",
#  "orbital": "HOMO",
#  "basis_name": "Def2-TZVPP",
#  "basis_size": 3,
#  "calc_type": "gw@hf",
#  "remark": "RIJK with PAUTO",
#  "data": {
#    "558-13-4": -10.8061762,
#    "593-60-2": -10.0394149,
#    "7440-63-3": -12.3233648,
#    "75-73-0": -16.7915237,
#    "463-58-1": -11.5024121,
#    "10028-15-6": -13.4934544,
#    "73-40-5": -8.35677789,
#    "7786-30-3": -11.891584,
#    "106-97-8": -12.132272,
#    "7789-24-4": -11.3059971,
#    "12184-80-4": -11.5538512,
#    "74-82-8": -14.7325081,
#    "7647-01-0": -12.7711218,
#    "12185-09-0": -10.5035863,
#    "75-19-4": -11.230947,
#    "74-84-0": -13.1394849,
#    "108-95-2_old": -8.95062171,
#    "13283-31-3": -13.6358368,
#    "7784-23-8": -9.97960634,
#    "12190-70-4": -7.13055277,
#    "25681-81-6": -3.84947348,
#    "7439-90-9": -14.0487715,
#    "7693-26-7": -6.27770441,
#    "64-18-6": -11.8903074,
#    "108-88-3": -9.07953882,
#    "39297-88-6": -4.41373034,
#    "1309-48-4": -7.82569396,
#    "75-01-4": -10.3097421,
#    "7732-18-5": -12.8153831,
#    "74-86-2": -11.5368448,
#    "108-95-2": -8.82961428,
#    "7783-63-3": -16.0322326,
#    "60-29-7": -10.4294394,
#    "1304-56-9": -9.75894033,
#    "544-92-3": -10.8315677,
#    "110-86-1": -9.83809178,
#    "593-66-8": -9.46061322,
#    "13768-60-0": -11.2604486,
#    "7664-39-3": -16.1683015,
#    "7784-18-1": -15.5866675,
#    "392-56-3": -10.5496715,
#    "1603-84-5": -10.7053737,
#    "7553-56-2": -9.67129809,
#    "14452-59-6": -5.28786507,
#    "7647-14-5": -9.19626902,
#    "57-13-6": -10.6124659,
#    "75-07-0": -10.7512955,
#    "7440-59-7": -24.6049555,
#    "74-85-1": -10.7062152,
#    "542-92-7": -8.78826266,
#    "100-41-4": -9.04552125,
#    "7782-41-4": -16.2644875,
#    "25681-80-5": -4.02652508,
#    "7782-79-8": -11.033917,
#    "65-71-4": -9.60767211,
#    "7783-40-6": -13.7896698,
#    "7580-67-8": -8.15439563,
#    "630-08-0": -14.9995568,
#    "71-30-7": -9.20550779,
#    "7783-60-0": -13.2477853,
#    "71-43-2": -9.44715002,
#    "12187-06-3": -7.12222488,
#    "7783-06-4": -10.4805196,
#    "75-02-5": -10.7639202,
#    "74-98-6": -12.5707818,
#    "629-20-9": -8.60255461,
#    "7726-95-6": -10.7908335,
#    "17108-85-9": -9.91329543,
#    "7803-62-5": -13.2255155,
#    "1590-87-0": -11.0675415,
#    "23878-46-8": -9.75957345,
#    "73-24-5": -8.62690209,
#    "124-38-9": -14.1610922,
#    "10043-11-5": -11.6852391,
#    "50-00-0": -11.3140733,
#    "25681-79-2": -4.93039848,
#    "7782-65-2": -12.8837432,
#    "74-90-8": -13.8189437,
#    "7440-37-1": -15.7350064,
#    "7440-01-9": -21.3513027,
#    "67-56-1": -11.511267,
#    "39297-86-4": -4.24295157,
#    "7727-37-9": -16.296476,
#    "507-25-5": -9.49829255,
#    "593-60-2_old": -9.43727104,
#    "7446-09-5": -12.888917,
#    "66-22-8": -10.0173378,
#    "7784-42-1": -10.5988494,
#    "14868-53-2": -9.7684913,
#    "7782-50-5": -11.7354189,
#    "1333-74-0": -16.4766726,
#    "7758-02-3": -8.24091762,
#    "62-53-3": -8.26932961,
#    "17739-47-8": -12.3176225,
#    "7803-51-2": -10.7609252,
#    "56-23-5": -11.9617308,
#    "7722-84-1": -12.0030625,
#    "7664-41-7": -11.1389171,
#    "19287-45-7": -12.776233,
#    "75-15-0": -10.2752212,
#    "64-17-5": -11.229551,
#    "302-01-2": -10.1094125
#  }
#}
#
#g0w0_pbeh075_homo = {
#  "code": "MOLGW",
#  "code_version": "2.E",
#  "basis": "gaussian",
#  "qpe": "solved",
#  "DOI": "https://doi.org/10.3389/fchem.2021.749779",
#  "orbital": "HOMO",
#  "remark": "RIJK with AUTO",
#  "basis_size": "3",
#  "basis_name": "Def2-TZVPP",
#  "calc_type": "gw@pbeh(0.75)",
#  "data": {
#    "10028-15-6": -13.200111,
#    "100-41-4": -8.79131165,
#    "10043-11-5": -11.5708907,
#    "106-97-8": -11.7943013,
#    "108-88-3": -8.83695246,
#    "108-95-2": -8.5588449,
#    "108-95-2_old": -8.67277851,
#    "110-86-1": -9.61905059,
#    "12184-80-4": -11.3679577,
#    "12185-09-0": -10.3495738,
#    "12187-06-3": -7.10597994,
#    "12190-70-4": -7.1149875,
#    "124-38-9": -13.904439,
#    "1304-56-9": -9.62689233,
#    "1309-48-4": -7.47995237,
#    "13283-31-3": -13.4646214,
#    "1333-74-0": -16.4193504,
#    "13768-60-0": -11.1363596,
#    "14452-59-6": -5.25928072,
#    "14868-53-2": -9.39686563,
#    "1590-87-0": -10.7540021,
#    "1603-84-5": -10.4893326,
#    "17108-85-9": -9.76668047,
#    "17739-47-8": -12.1541811,
#    "19287-45-7": -12.5284819,
#    "23878-46-8": -9.61206185,
#    "25681-79-2": -4.89713438,
#    "25681-80-5": -3.95102055,
#    "25681-81-6": -3.77425635,
#    "302-01-2": -9.83192821,
#    "392-56-3": -10.1950261,
#    "39297-86-4": -4.18486158,
#    "39297-88-6": -4.31627584,
#    "463-58-1": -11.2763694,
#    "50-00-0": -11.0498276,
#    "507-25-5": -9.19675999,
#    "542-92-7": -8.55824286,
#    "544-92-3": -10.5035436,
#    "558-13-4": -10.5038501,
#    "56-23-5": -11.6657188,
#    "57-13-6": -10.2650193,
#    "593-60-2": -9.79721545,
#    "593-60-2_old": -9.20221626,
#    "593-66-8": -9.22209963,
#    "60-29-7": -10.0915583,
#    "62-53-3": -7.98646432,
#    "629-20-9": -8.33674112,
#    "630-08-0": -14.6630421,
#    "64-17-5": -10.8991853,
#    "64-18-6": -11.6063326,
#    "65-71-4": -9.27247542,
#    "66-22-8": -9.68746951,
#    "67-56-1": -11.2122549,
#    "71-30-7": -8.88783654,
#    "71-43-2": -9.2167981,
#    "73-24-5": -8.3413849,
#    "73-40-5": -8.0684439,
#    "7439-90-9": -13.8187901,
#    "7440-01-9": -21.1051305,
#    "7440-37-1": -15.4986569,
#    "7440-59-7": -24.4929723,
#    "7440-63-3": -12.0889837,
#    "7446-09-5": -12.5629676,
#    "74-82-8": -14.4860342,
#    "74-84-0": -12.8794971,
#    "74-85-1": -10.5086435,
#    "74-86-2": -11.3410406,
#    "74-90-8": -13.6227188,
#    "74-98-6": -12.2253356,
#    "75-01-4": -10.0701146,
#    "75-02-5": -10.5103727,
#    "75-07-0": -10.4169401,
#    "75-15-0": -10.0591296,
#    "75-19-4": -10.9260935,
#    "7553-56-2": -9.42724521,
#    "75-73-0": -16.4462914,
#    "7580-67-8": -8.07715762,
#    "7647-01-0": -12.547997,
#    "7647-14-5": -8.97903395,
#    "7664-39-3": -15.9177018,
#    "7664-41-7": -10.8792385,
#    "7693-26-7": -6.18668416,
#    "7722-84-1": -11.7138575,
#    "7726-95-6": -10.5513869,
#    "7727-37-9": -15.935756,
#    "7732-18-5": -12.5554505,
#    "7758-02-3": -8.02209291,
#    "7782-41-4": -15.9492299,
#    "7782-50-5": -11.4991393,
#    "7782-65-2": -12.6590938,
#    "7782-79-8": -10.8019373,
#    "7783-06-4": -10.2665872,
#    "7783-40-6": -13.5565007,
#    "7783-60-0": -12.8751436,
#    "7783-63-3": -15.6423935,
#    "7784-18-1": -15.3177751,
#    "7784-23-8": -9.7100942,
#    "7784-42-1": -10.3861181,
#    "7786-30-3": -11.666651,
#    "7789-24-4": -11.0794253,
#    "7803-51-2": -10.5551564,
#    "7803-62-5": -13.0099619
#  }
#}
#
## Optimal Range-separation in bohr^{-1}
## from "An optimally tuned range-separated hybrid starting point for ab initio GW plus Bethe–Salpeter equation calculations of molecules"
## McKeon et. al. JChemPhys 157, 074103 (2022) 
## https://doi.org/10.1063/5.0097582
## obtained by e_GKS = e_GW
#otrsh_gamma_gw = {'100-41-4': 0.21, '10028-15-6': 0.364, '10043-11-5': 0.378, '106-97-8': 0.346, '108-88-3': 0.22, '108-95-2_old': 0.236, '108-95-2': 0.234, '110-86-1': 0.244, '12184-80-4': 0.346, '12185-09-0': 0.284, '12187-06-3': 0.294, '12190-70-4': 0.266, '124-38-9': 0.388, '1304-56-9': 0.316, '1309-48-4': 0.214, '13283-31-3': 0.482, '1333-74-0': 0.696, '13768-60-0': 0.394, '14452-59-6': 0.196, '14868-53-2': 0.206, '1590-87-0': 0.282, '1603-84-5': 0.296, '17108-85-9': 0.31, '17739-47-8': 0.308, '19287-45-7': 0.43, '23878-46-8': 0.288, '25681-79-2': 0.192, '25681-80-5': 0.16, '25681-81-6': 0.142, '302-01-2': 0.368, '392-56-3': 0.246, '39297-86-4': 0.176, '39297-88-6': 0.132, '463-58-1': 0.316, '50-00-0': 0.396, '507-25-5': 0.204, '542-92-7': 0.258, '544-92-3': 0.302, '558-13-4': 0.252, '56-23-5': 0.282, '57-13-6': 0.312, '593-60-2_old': 0.286, '593-60-2': 0.286, '593-66-8': 0.258, '60-29-7': 0.318, '62-53-3': 0.234, '629-20-9': 0.254, '630-08-0': 0.398, '64-17-5': 0.37, '64-18-6': 0.36, '65-71-4': 0.246, '66-22-8': 0.25, '67-56-1': 0.388, '71-30-7': 0.24, '71-43-2': 0.222, '73-24-5': 0.22, '73-40-5': 0.216, '74-82-8': 0.442, '74-84-0': 0.428, '74-85-1': 0.32, '74-86-2': 0.364, '74-90-8': 0.398, '74-98-6': 0.388, '7439-90-9': 0.374, '7440-01-9': 0.634, '7440-37-1': 0.43, '7440-59-7': 0.908, '7440-63-3': 0.306, '7446-09-5': 0.344, '75-01-4': 0.298, '75-02-5': 0.336, '75-07-0': 0.346, '75-15-0': 0.28, '75-19-4': 0.298, '75-73-0': 0.424, '7553-56-2': 0.24, '7580-67-8': 0.358, '7647-01-0': 0.374, '7647-14-5': 0.304, '7664-39-3': 0.506, '7664-41-7': 0.386, '7693-26-7': 0.26, '7722-84-1': 0.394, '7726-95-6': 0.288, '7727-37-9': 0.396, '7732-18-5': 0.428, '7758-02-3': 0.276, '7782-41-4': 0.47, '7782-50-5': 0.33, '7782-65-2': 0.386, '7782-79-8': 0.362, '7783-06-4': 0.334, '7783-40-6': 0.406, '7783-60-0': 0.368, '7783-63-3': 0.336, '7784-18-1': 0.428, '7784-23-8': 0.222, '7784-42-1': 0.342, '7786-30-3': 0.31, '7789-24-4': 0.406, '7803-51-2': 0.346, '7803-62-5': 0.408}
#
## obtained by IP theorem: e_GKS = E_GKS(0) - E_GKS(+)
#otrsh_gamma_ip = {'100-41-4': 0.216, '10028-15-6': 0.998, '10043-11-5': 0.212, '106-97-8': 0.298, '108-88-3': 0.226, '108-95-2_old': 0.25, '108-95-2': 0.248, '110-86-1': 0.26, '12184-80-4': 0.348, '12185-09-0': 0.998, '12187-06-3': 0.274, '12190-70-4': 0.276, '124-38-9': 0.4, '1304-56-9': 0.288, '1309-48-4': 0.162, '13283-31-3': 0.426, '1333-74-0': 0.654, '13768-60-0': 0.378, '14452-59-6': 0.2, '14868-53-2': 0.192, '1590-87-0': 0.266, '1603-84-5': 0.328, '17108-85-9': 0.2, '17739-47-8': 0.29, '19287-45-7': 0.39, '23878-46-8': 0.298, '25681-79-2': 0.206, '25681-80-5': 0.172, '25681-81-6': 0.17, '302-01-2': 0.358, '392-56-3': 0.26, '39297-86-4': 0.162, '39297-88-6': 0.132, '463-58-1': 0.344, '50-00-0': 0.362, '507-25-5': 0.254, '542-92-7': 0.252, '544-92-3': 0.34, '558-13-4': 0.288, '56-23-5': 0.32, '57-13-6': 0.426, '593-60-2_old': 0.292, '593-60-2': 0.3, '593-66-8': 0.33, '60-29-7': 0.26, '62-53-3': 0.242, '629-20-9': 0.236, '630-08-0': 0.404, '64-17-5': 0.326, '64-18-6': 0.33, '65-71-4': 0.236, '66-22-8': 0.25, '67-56-1': 0.358, '71-30-7': 0.24, '71-43-2': 0.242, '73-24-5': 0.236, '73-40-5': 0.224, '74-82-8': 0.388, '74-84-0': 0.368, '74-85-1': 0.31, '74-86-2': 0.35, '74-90-8': 0.392, '74-98-6': 0.332, '7439-90-9': 0.448, '7440-01-9': 0.67, '7440-37-1': 0.494, '7440-59-7': 0.92, '7440-63-3': 0.388, '7446-09-5': 0.394, '75-01-4': 0.304, '75-02-5': 0.326, '75-07-0': 0.308, '75-15-0': 0.294, '75-19-4': 0.286, '75-73-0': 0.452, '7553-56-2': 0.32, '7580-67-8': 0.326, '7647-01-0': 0.414, '7647-14-5': 0.34, '7664-39-3': 0.51, '7664-41-7': 0.372, '7693-26-7': 0.244, '7722-84-1': 0.428, '7726-95-6': 0.368, '7727-37-9': 0.484, '7732-18-5': 0.42, '7758-02-3': 0.372, '7782-41-4': 0.57, '7782-50-5': 0.4, '7782-65-2': 0.358, '7782-79-8': 0.348, '7783-06-4': 0.362, '7783-40-6': 0.442, '7783-60-0': 0.366, '7783-63-3': 0.85, '7784-18-1': 0.522, '7784-23-8': 0.286, '7784-42-1': 0.34, '7786-30-3': 0.37, '7789-24-4': 0.42, '7803-51-2': 0.336, '7803-62-5': 0.36}


########################################################################
def diff(data1, data2):
    """
        Returns a dictionary containing data2 - data1
    """
    errors = dict()
    shared_keys = set(data1.keys()) & set(data2.keys())
    for cas in shared_keys:
        errors[cas] = data2[cas] - data1[cas]
    return errors

########################################################################
def mae_mse_max(data1, data2):
    """
        Returns MAE, MSE, Max errors with data1 being the reference
    """
    errors = list( diff(data1, data2).values() )

    ndata = len(errors)
    mse = sum(errors) / float(ndata)
    mae = sum(np.abs(errors)) / float(ndata)
    mxe = np.max(np.abs(errors))
    return mae, mse, mxe
